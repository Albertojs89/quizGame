<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>HeroQuest ‚Äì Sala de los Pasos Fugaces</title>

<style>
  body{
    margin:0;
    min-height:100vh;
    display:grid;
    place-items:center;
    background:#0b0e14;
    font-family:system-ui, sans-serif;
    color:#eee;
  }

  .wrap{
    background:#121827;
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    padding:16px;
    width:320px;
  }

  h1{
    font-size:14px;
    margin:0 0 8px;
    text-align:center;
    font-weight:600;
  }

  .hud{
    display:flex;
    justify-content:space-between;
    font-size:13px;
    margin-bottom:10px;
    color:#ccc;
  }

  .board{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    grid-template-rows:repeat(5,1fr);
    gap:8px;
  }

  .tile{
    aspect-ratio:1/1;
    border-radius:10px;
    background:#1a2438;
    border:1px solid rgba(255,255,255,.08);
    cursor:pointer;
    transition:.08s;
  }

  .tile.flash{
    background:#ffd500;
    box-shadow:0 0 18px rgba(255,213,0,.8);
  }

  .tile.correct{
    background:#c9b400;
  }

  .tile.wrong{
    background:#a03030;
    box-shadow:0 0 16px rgba(255,60,60,.6);
  }

  .footer{
    margin-top:10px;
    font-size:12px;
    color:#aaa;
    text-align:center;
  }

  button{
    margin-top:8px;
    width:100%;
    padding:8px;
    background:#1f2a44;
    border:1px solid rgba(255,255,255,.15);
    border-radius:8px;
    color:#eee;
    font-weight:600;
    cursor:pointer;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Sala de los Pasos Fugaces</h1>

  <div class="hud">
    <div>‚ù§Ô∏è Vidas: <b id="hp">3</b></div>
    <div>üß† Paso: <b id="step">0</b></div>
  </div>

  <div class="board" id="board"></div>

  <button id="start">Iniciar secuencia</button>

  <div class="footer">
    Memoriza. Pisa en orden. Fallo = ‚àí1 vida.
  </div>
</div>

<script>
const COLS = 3;
const ROWS = 5;
const FLASH_MS = 120;     // MUY r√°pido
const GAP_MS   = 50;
const PATH_LEN = 10;      // largo y dif√≠cil
let lives = 3;
let path = [];
let step = 0;
let active = false;
let tiles = [];

const board = document.getElementById("board");
const hpEl = document.getElementById("hp");
const stepEl = document.getElementById("step");

function idx(x,y){ return y*COLS+x }
function inBounds(x,y){ return x>=0 && y>=0 && x<COLS && y<ROWS }

function build(){
  board.innerHTML="";
  tiles=[];
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      const t=document.createElement("div");
      t.className="tile";
      t.dataset.x=x;
      t.dataset.y=y;
      t.onclick=()=>clickTile(x,y,t);
      board.appendChild(t);
      tiles.push(t);
    }
  }
}

function neighbors(c){
  return [
    {x:c.x+1,y:c.y},
    {x:c.x-1,y:c.y},
    {x:c.x,y:c.y+1},
    {x:c.x,y:c.y-1}
  ].filter(n=>inBounds(n.x,n.y));
}

function randomPath(){
  const used=new Set();
  const p=[{x:1,y:0}]; // empieza arriba-centro
  used.add("1,0");

  while(p.length<PATH_LEN){
    const opts=neighbors(p[p.length-1])
      .filter(n=>!used.has(`${n.x},${n.y}`));
    if(!opts.length) return randomPath();
    const n=opts[Math.floor(Math.random()*opts.length)];
    used.add(`${n.x},${n.y}`);
    p.push(n);
  }
  return p;
}

async function flash(){
  active=false;
  step=0;
  stepEl.textContent=step;
  tiles.forEach(t=>t.classList.remove("correct","wrong"));

  for(const c of path){
    const t=tiles[idx(c.x,c.y)];
    t.classList.add("flash");
    await wait(FLASH_MS);
    t.classList.remove("flash");
    await wait(GAP_MS);
  }
  active=true;
}

function clickTile(x,y,t){
  if(!active) return;
  const exp=path[step];

  if(x===exp.x && y===exp.y){
    t.classList.add("correct");
    step++;
    stepEl.textContent=step;
    if(step===path.length){
      active=false;
      alert("‚úî Cofre alcanzado");
    }
  }else{
    t.classList.add("wrong");
    active=false;
    lives--;
    hpEl.textContent=lives;
    if(lives<=0){
      alert("‚ò† Sin vidas");
      return;
    }
    setTimeout(flash,300);
  }
}

function wait(ms){ return new Promise(r=>setTimeout(r,ms)) }

document.getElementById("start").onclick=()=>{
  path=randomPath();
  flash();
};

build();
</script>
</body>
</html>
